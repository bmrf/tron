| NAME       | Tron, автоматический скрипт для очистки ПК                                                                                             |
| :--------- | :------------------------------------------------------------------------------------------------------------------------------------- |
| AUTHOR     | Пожертвованя on [reddit.com/r/TronScript](https://reddit.com/r/tronscript) (`vocatus d0t gate@gmail`) // PGP key: `0x07d1490f82a211a2` |
| BACKGROUND | Зачем во имя %name%? Tron "Сражается за Пользователя"                                                                                  |

# НЕ СКАЧИВАЙТЕ С GITHUB, СКРИПТ НЕ БУДЕТ РАБОТАТЬ!! ВАМ НУЖЕН ПОЛНЫЙ ПАКЕТ ИЗ [/r/TronScript](https://www.reddit.com/r/TronScript) !!

Я устал запускать эти утилиты вручную, и решил отдать это на волю скрипта. Tron, по сути — это batch файл, который автоматизирует несколько задач по очистке Windows машины.

# Содержание

1. [Информацию по использованию](#use)

2. [Использование командной строки](#command-line-use)

3. [Прерывание скрипта](#script-interruption)

4. [Заметки по Безопасному режиму](#safe-mode)

5. [Отправка вывода на почту](#email-report)

6. [Изменение стандартных параметров](#change-defaults-advanced)

7. [Целостность](#integrity)

8. [Лицензия](#license)

9. [Контактная информация](#other)

10. [Полное описание всех действий](#full-tron-description)


# USE

1. [Загрузиться в безопасный режим с поддержкой сетевых драйверов](#safe-mode).Безопасный режим не обязателен, но очень рекомендуем. Если Вы пропустите этот шаг, Tron автоматически предложит загрузиться в безопасный режим.
2. Скопируйте `tron.bat` и директорию `\resources` на Рабочий Стол ПК и запустите `tron.bat` с правами **АДМИНИСТРАТОРА**(Tron не будет работать если не дать ему прав администратора)
3. Подождите **3-10 часов** (да, это долго)
4. Перезагрузка.

По стандартным параметрам, мастер-лог файл находится по пути `C:\Logs\tron\tron.log`. Если Вы хотите изменить эти параметры, прочитайте раздел с изменением стандартных параметров ниже.

Tron в обязательном порядке проверит наличие новой версии при запуске и уведомит Вас если новая версия доступна.

В зависимости от того, на сколько сильно система заражена, может изменяться время работы скрипта. От 3 до 10 часов. Лично мной замечено 4-8 часов, и один пользователь сообщил, что скрипт работал 30 часов. Так что, запустите и забудьте.


#command-line-use

Командная строка полностью поддерживается. Все флаги опциональны и могут быть совмещены. *

    tron.bat [-a -c -d -dev -e -er -m -o -p -r -sa -sb -sd -se -sfr -sk -sm 
              -sp -spr -srr -ss -str -sw -v -x] | [-h]
    Опциональные флаги. (Могут быть совмещены)
	-a	автоматический режим(Без режима приветствия или вывода; Предполагает -e)
	
	-с	Вывод текущей конфигурации.(может быть использован с другими флагами,чтобы узнать ЧТО произойдет, но скрипт никогда не запустится)
	-d	Пробный запуск.(Запускает скрипт без запуска каких либо работ)
	
	-dev	Отменяет проверку версии ОС.(Позволяет запустить скрипт на не поддерживаемых версиях Windows)
	
	-e	Принять EULA.(Отменяет экран предупреждения об отказе от ответственности)
	
	-er	Отправка на электронную почту информацию о завершении работы скрипта. Необходимо настроить SwithMailSettings.xml
	
	-m	Сохранить стандартные Metro-приложения.(Не удаляет их)
	
	-o	Выключить ПК после завершения. Отменяет -r.
	
	-p	Сохранить настройки питания.(Не сбрасывать до стандартных настроек Windows)
	
	-r	Автоматическая перезагрузка. (Авто-перезагрузка через 15 секунд после завершения)
	
	-sa	Отменить ВСЕ сканирования антивирусами.(RVRT, MBAM, SAV)
	
	-sb	Пропустить раздутое программное обеспечение. (OEM полное удаление раздутого программного обеспечения; предполагает -m)
	
	-sd	Пропустить дефрагментацию.(Принудительно заставить Tron ВСЕГДА пропускать Stage 5 дефрагментацию)
	
	-se	Отключить очищение журнала Windows.(Не удалять записи из журнала Windows)
	
	-sfr	отменить сброс прав в файловой системе(Сохраняет время если вы торопитесь)
	
	-sk	Отменить проверку Kaspersky Virus Tool(KVRT).
	
	-sm	Отменить проверку Malwarebytes Anti-Malware(MBAM).
	
	-ap	Отменить патчи. (Не патчить 7-zip, Java Runtime, Adobe Flash или Reader)
	
	-spr	Отменить сброс файла подкачки.(Не ставить флаг "Разрешить Windows управлять файлом подкачки")
	
	-srr	Пропустить сброс прав реестра.(Сохраняет время если Вы торопитесь)
	
	-ss	Пропустить проверку Sophos Anti-virus(SAV)
	
	-str	Пропустить удаление средств телеметрии.(Не отменять удаление сбора информации о пользователе. ТОЛЬКО Win7 и выше)
	
	-sw	Пропустить попытку запустить Windows Update.
	
	-v	Подробный вывод. Показывать весь доступный вывод.(ВНИМАНИЕ! Значительно замедляет процесс!)
	
	-x	Самоуничтожение. Tron удалит себя после выполнения работы и оставит после себя лог-файл.
	
	Дополнительный флаги(Не комбинировать с чем-то еще)
	-h	Вывести на экран Help.
\* Нет флагов -UMP


# SCRIPT INTERRUPTION

Если скрипт прерван, к примеру, сбоем или принудительной перезагрузкой(Часто встречается на Stage_2_de-bloat(удаление раздутого программного обеспечения)), он попытается продолжить с последней успешной стадии. Это реализовано через добавление `RunOnce` в реестре от имени текущего пользователя в начале Stage_0(то есть, когда скрипт только запущен). И удалением записи в конце работы скрипта если завершение работы произведено без прерываний. 

Более детально об этой функции читайте ниже в этом документе. 


# SAFE MODE

Tron *не нуждается* в запуске из Безопасного режима, но это **настоятельно рекомендуется**.

Сразу после запуска Tron принудительно проверит на факт запуска из Безопасного режима с поддержкой сети Интернет. Если это не так, предложит вам перезагрузиться в него.


# EMAIL REPORT
Чтобы Tron отправил Вам письмо о завершении работы, редактируйте этот файл:
    
    \tron\resources\stage_7_wrap-up\email_report\SwithMailSettings.xml

Укажите свой SMTP сервер, логин и пароль. После конфигурирования данного файла, можете использовать флаг `-er` для отправки оповещения. Общие логи (`tron_removed_files.txt` и `tron_removed_programs.txt`) будут прикреплены. 

Учтите, что логин и пароль от электронной почты сохранены в не зашифрованном виде ОТКРЫТЫМ ТЕКСТОМ. Соблюдайте осторожность на ПК которому не доверяете. 


# CHANGE DEFAULTS (advanced)

Если Вы не хотите использовать командную строку, и Вам не нравится стандартные настройки Tron, Вы можете поменять следующие параметры. Учтите что флаги командной строки всегда будут иметь приоритет выше чем указанные настройки по-умолчанию.

- чтобы изменить директорию мастер-лог файла Tron, измените данную строку:
	```
	set LOGPATH=%SystemDrive%\Logs\tron
	```

- чтобы изменить название мастер-лог файла Tron, измените данную строку:
	```
	set LOGFILE=tron.log
	```

- чтобы изменить директорию, где Tron хранит файлы из карантина, измените эту строку.(Внимание! В данный момент не используется Tron'ом, этот параметр не оказывает эффекта)
	```
	set QUARANTINE_PATH=%LOGPATH%\quarantine
	```

- чтобы изменить директорию бэкапов которые создает Tron(реестр, журнал событий Windows, параметры питания, и тому прочее), измените данную строку:
	```
	set BACKUPS=%LOGPATH%\backups
	```

- чтобы изменить директорию, где Tron хранит не сжатый дамп логов от различных утилит, измените данную строку:
	```
	set RAW_LOGS=%LOGPATH%\raw_logs
	```

- чтобы изменить директорию, где Tron хранит общий лог, измените данную строку:
	```
	set SUMMARY_LOGS=%LOGPATH%\summary_logs
	```

- чтобы Tron всегда запускался в автоматическом режиме(без приветсвенного экрана, запроса на согласие EULA), измените данное значение на `yes`:
	```
	set AUTORUN=no
	```

- чтобы запустить тестовый запуск(без выполения каких-либо работ), измените данное значение на `yes`:
	```
	set DRY_RUN=no
	```

- чтобы отменить проверку версии ОС(разрешает запуск на не поддерживаемой версии Windows), измените данное значение на `yes`:
	```
	set DEV_MODE=no
	```

- чтобы автоматически принять пользовательское соглашение(EULA)(Отменяет экран предупреждения об отказе от ответсвенности), измените данный параметр на `yes`:
	```
	set EULA_ACCEPTED=no
	```

- чтобы заставить Tron отправлять письмо на почту о завершении, измените данный параметр на `yes`:
	```
	set EMAIL_REPORT=no
	```

- чтобы сохранить настройки Metro-приложений(не удалять их), измените данный параметр на `yes`:
	```
	set PRESERVE_METRO_APPS=no
	```

- чтобы выключить Пк после завершения работы Tron, измените данный параметр на `yes`:
	```
	set AUTO_SHUTDOWN=no
	```

- чтобы сохранить настройки схемы питания Windows(вместо того, что бы сбросить их до стандартных настроек windows), измените данный параметр на `yes`:
	```
	set PRESERVE_POWER_SCHEME=no
	```

- чтобы настроить время автоматической перезагрузки после выполнения Tron, измените данное значение(в секундах). `0` отключает автоматическую перезагрузку. 
	```
	set AUTO_REBOOT_DELAY=0
	```

- чтобы пропустить сканирование антивирусами(MBAM, KVRt, Sophos), измените данное значение на `yes`:
	```
	set SKIP_ANTIVIRUS_SCANS=no
	```

- чтобы пропустить очистку от раздутого программного обеспечения, измените данный параметр на `yes`:
	```
	set SKIP_DEBLOAT=no
	```

- чтобы всегда пропускать дефрагментацию, независимо от того, находиться ли системный раздел(`C:\`) на SSD или нет, измените данный параметр на `yes`:
	```
	set SKIP_DEFRAG=no
	```

- чтобы отключить очистку журнала событий Windows, измените данный параметр на `yes`:
	```
	set SKIP_EVENT_LOG_CLEAR=no
	```

- чтобы отменить получение пользователями SYSTEM и Administrator полные права на изменение подкаталогов `%WinDri%`, измените данный параметр на `yes`:
	```
	set SKIP_FILEPERMS_RESET=no
	```

- чтобы отменить сканирование утилитой Kaspersky Virus Rescue Tool (KVRT), измените данный параметр на `yes`:
	```
	set SKIP_KASPERSKY_SCAN=no
	```

- чтобы отменить установку Malwarebytes Anti-Malware (MBAM), измените данный параметр на `yes`:
	```
	set SKIP_MBAM_INSTALL=no
	```

- чтобы отменить патчи(не устанавливать патч для 7-zip, java runtime, adobe flash и reader), измените данный параметр на `yes`:
	```
	set SKIP_PATCHES=no
	```

- чтобы отменить настройки файла подкачки до стандартных настроек windows, измените данный параметр на `yes`:
	```
	set SKIP_PAGEFILE_RESET=no
	```

- чтобы отменить получение пользователями SYSTEM и Administrator полных прав на ветки реестра HKLM, HKCU, HKCR, измените данный параметр на `yes`:
	```
	set SKIP_REGPERMS_RESET=no
	```

- чтобы отменить сканирование Sophos Anti-virus (SAV), измените данный параметр на `yes`:
	```
	set SKIP_SOPHOS_SCAN=no
	```

- чтобы отключить полное удаление средств телеметрии Windows(сбор пользовательских данных), измените данный параметр на `yes`:
	```
	set SKIP_TELEMETRY_REMOVAL=no
	```

- чтобы отменить попытку запуска Windows Update, измените данный параметр на `yes`:
	```
	set SKIP_WINDOWS_UPDATES=no
	```

- чтобы включить отображение всего доступного вывода, измените данный параметр на `yes`:
	```
	set VERBOSE=no
	```

- чтобы включить автоматическое удаление Tron после завершения(самоуничтожение), измените данный параметр на `yes`:
	```
	set SELF_DESTRUCT=no
	```

* Нет флагов '-UMP'.


# INTEGRITY

В каждом релизе, файл 
`\tron\integrity_verification\chechsums.txt` содержит SHA-256 хэши *каждого* файла используемого Tron, и подписаны моим PGP ключем (`0x07d1490f82a211a2`, включетельно). Вы можете использовать их для проверки целостности пакетов.


# LICENSE

Tron и любые используемые им скрипты и `.reg` файлы были написаны бесплатно для использования/каких-угодно_действий под лицензией **MIT License**. Было бы очень приятно, если бы вы отправили мне письмо, если делаете/сделали что-то крутое с этим. Но это не обязательно. Все программное обеспечение третьей стороны (MBAM, TSSSK, и т.д.) распространяются отдельно  и имеют свои собственные лицензии. Это ВАША ответственность решать, можете ли вы их использовать в Своих специфических ситуациях.


# OTHER

Я стараюсь обновлять все материалы своевременно. Если вы заметили, что некоторые пакеты просрочены, отправьте мне личное сообщение на Reddit, или отправьте письмо на почту(смотрите выше), я отвечу в свое свободное время. 

Надеюсь это поможет остальным технарям.

- Пожертвования: 

Если вы чувствуете себя сверх-щедрыми:
	```
	1LSJ9qDzuHyRx6FfbUmHVSii4sLU3sx2TF
	```


# FULL TRON DESCRIPTION
Самый простой способ узнать, что делает Tron, это открыть `Tron.bat` с помощью текстового редактора(желательно с подсветкой синтаксиса) или [на GitHub и просто читать код](https://github.com/bmrf/tron/blob/master/tron.bat). Каждая секция имеет комментарии описывающие действия, поэтому Вам не обязательно быть программистом что бы понять код. В любом случае, не смотря на это, вот общее описание каждого действия скрипта.

## tron.bat
Главный скрипт, запускающий все другие инструменты. Он использует большое количество действий сам по себе, но не все задачи мы можем выполнить непосредственно, поэтому вызываем дополнительные инструменты или скрипты. 

## Tron-internal prep jobs (подготовительные работы Tron)
(Данные скрипты/инструменты работоспособны даже если Tron не запустил их самостоятельно)

1. **Определение на запуск из TEMP**: Определяет, из какой директории запущен Tron, Если это TEMP, прерывает запуск. TEMP это первое место, которое Tron очищает при запуске, поэтому не может быть запущен оттуда.

2. **Определение версии Windows и Internet Explorer**: Определяет довольно много параметров в сценарии, на пример, какие версии различных команд будут использованы. 

3. **Не поддерживаемая ОС**: Выдает сообщение об ошибке если запуск происходит на не поддерживаемой ОС и прерывается. Используйте флаг `-dev`, что бы отменить эту проверку и разрешить запуск на не поддерживаемой версии windows. 

4. **Обнаружение SSD**: Обнаруживает твердотельные накопитель используемый под системный диск. Если такой обнаружен, отменяет **Stage_5_defrag**.(Отменяет дефрагментацию)

5. **Определяет свободное пространство на диске**: Определяет свободное пространство на диске для будущего сравнения. Просто используется, что бы показать, сколько свободного пространства появилось после проделанной работы. Не влияет на любые функции скрипта.

6. **Определяет факт запуска**: Проверяет была ли работа скрипта продолжена после прерывания, на пример, перезагрузки. 

7. **Включает меню выбора загрузки в Безопасный Режим**: Включает возможность использовать кнопку `F8` при загрузке (Только windows 8/8.1; включено по-умолчанию на server 2012/2012 R2)

8. **Проверяет на наличие новой версии**: Использует `wget` что бы скачать `sha256sums.txt` с зеркала Tron, и определить, является ли данная версия последней. Tron автоматически спросит Вас о загрузке новой версии. Если ответите ДА, он скачает ее на Рабочий Стол, проверит SHA-256 хэш, и удалит текущую версию.

9. **Проверка наличия прав**: Проверяет наличие прав администратора, в случае отказа, выведет на экран ошибку. 

10. **Определение Безопасного Режима**: Определяет, находиться ли ОС в Безопасном Режиме, уведомляет если это не так.

11. **Создает лог-директории**: Создает директории мастер-лог файла и поддиректории, если они не существуют.


## STAGE 0: Prep (стадия 0: подготовка)

1. **Создает RunOnce запись**: Создает в реестре запись для поддержки продолжения работы после прерывания. `HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce /v "tron_resume" /t REG_SZ /d "%~dp0tron.bat %-resume"`

2. **SMART проверка**: Запускает быстрый SMART-тест на определение здоровья дисков, и уведомляет если какой-то из дисков не имеет статуса "OK". 

3. **Создает точку восстановления системы**: Только Windows Vista и выше. Не поддерживается на серверных редакциях ОС. Tron создает точку восстановления системы перед началом операций.

4. **[Rkill](http://www.bleepingcomputer.com/download/rkill/)**: Rkill это anti-malware проверочная утилита. Она ищет malware и убивает мешающие инструментам удаления. Rkill игнорирует любой процесс указанный в `\resources\stage_0_prep\rkill\rkill_process_whitelist.txt` 

5. **ProcessKiller**: Утилита предоставленная /u/cuddlychops06 которая убивает ряд процессов запущенных от имени пользователя. Мы используем ее так же, для завершения любых процессов которые могут иметь конфликты с Tron. Конкретно, она завершает все процессы запущенные от имени пользователя, кроме `ClassicShellService.exe`, `explorer.exe`, `dwm.exe`, `cmd.exe`, `mbam.exe`, `teamviewer.exe`, `TeamViewer_Service.exe`, `Taskmgr.exe`, `Teamviewer_Desktop.exe`, `MsMpEng.exe`, `tv_w32.exe`, `VTTimer.exe`, `Tron.bat`, `rkill.exe`, `rkill64.exe`, `rkill.com`, `rkill64.com`, `conhost.exe`, `dashost.exe`, `wget.exe`

6. **Безопасный Режим**: Вынуждает систему перезагрузиться в безопасный режим с поддержкой сетевых драйверов если происходит перезагрузка. Tron самостоятельно убирает данные настройки и восстанавливает значения по-умолчанию в конце работы скрипта. Вызывается командой:
	```
	bcdedit /set {default} safeboot network
	```

7. **Устанавливает системное время через NTP**: Синхронизирует системные часы с time.nist.gov, 3.pool.ntp.org, time.windows.com

8. **Проверяет и восстанавливает WMI**: Проверяет WMI интерфейс и восстанавливает если поврежден. Tron использует WMI для многих целей, включая конвертацию формата даты в ISO, для полного удаления раздутого ПО, и для других различных задач. Критически необходимо для работы Tron.

9. **[McAfee Stinger](http://www.mcafee.com/us/downloads/free-tools/stinger.aspx)**: Anti-Malware/rootkit/virus самостоятельный сканер от McAfee. Не поддерживает ведение лога открытым текстом, так что мы используем HTML логи в `%LOGPATH%` Tron'а. Tron запускает Stinger через:
	```
	stinger32.exe --GO --SILENT --PROGRAM --REPORTPATH="%LOGPATH%" --RPTALL --DELETE
	```

10. **[TDSS Killer](http://usa.kaspersky.com/downloads/TDSSKiller)**: Anti-rootkit утилита от Лаборатории Касперского. Tron запускает командой:
	```
	dsskiller.exe -l %TEMP%\tdsskiller.log -silent -tdlfs -dcexact -accepteula -accepteulaksn
	```

11. **[erunt](http://www.larshederer.homepage.t-online.de/erunt/)**: Используется для создания бекапа реестра.

12. **VSS purge**: Безвозвратно удаляет скрытые файлы, которые являются старой резервной копией файлов. Malware часто могут прятаться именно там.

13. **Изменяет данные о размере места для восстановления системы**: Изменяет настройки системы, что бы она использовала для восстановления 7% от доступного свободного места на диске.

14. **Отключает спящий режим**: Tron использует `caffeine.exe` для отключения спящего режима когда скрипт стартует. В конце скрипта он сбрасывает настройки питания Windows на настройки по-умолчанию. Использование флага `-p` в скрипте Tron предотвращает сброс настроек питания.


## STAGE 1: TempClean (СТАДИЯ 1: Очистка временных файлов)

1. **Очистка Internet Explorer**: Запускает встроенную в Windows функцию очистки и сброса настроек IE:
	```
	rundll32.exe inetcpl.cpl,ClearMyTracksByProcess 4351
	```
	
2. **[CCLeaner](https://www.piriform.com/ccleaner)**: Утилита для очистки временных файлов. Запуск производиться перед запуском AV сканнеров.

3. **[BleachBit](http://bleachbit.sourceforge.net/)**: Утилита для удаления временных файлов. Запуск производиться перед запуском AV сканнеров.

4. **TempFileCleanup.bat**: Лично мной написанный скрипт, который очищает файлы/директории которые другие утилиты пропускают.

5. **[DriveCleanup.exe](http://www.uwe-sieber.de/drivetools_e.html#drivecleanup)**:Удаляет неиспользуемые\давно_не_используемые_драйверы_USB. Утилита от Uwe SIeber.

6. **Очистка журнала событий Windows**: Делает резервную копию журнала событий по умолчанию в '%LOGPATH%', после удаляет записи из журнала.

7. **Очистка кэша Windows Update**: Безвозвратно удаляет файлы установки для уже установленных обновлений. Обычно освобождает немного пространства на диске. 


## STAGE 2: De-bloat (СТАДИЯ 3:Удаление раздутого ПО)
1. **OEM De-bloat** (от name): использует WMI для удаления любой программы указанной в этом файле:
	```
	\tron\resources\stage_2_de-bloat\oem\programs_to_target_by_name.txt
	```

2. **OEM de-bloat** (от GUID): Использует WMI для удаления программ указанных в файле:
	```
	\tron\resources\stage_2_de-bloat\oem\programs_to_target_by_GUID.bat
	```

3. **Toolbar & BHOs** (от GUID): Использует WMI для удаления программ указанных в файле:
	```
	\resources\stage_3_de-bloat\toolbars_BHOs_to_target_by_GUID.bat
	```

4. **Metro de-bloat**: Удаляет пред. установленные Metro-приложения которые никто не использует.(Не удаляет такие приложения как Калькулятор, Paint) Потом удаляет их из кэша(Вы всегда можете вернуть их позже через Windows Update)


## STAGE 3: Disinfect (СТАДИЯ 3: Дезинфекция)
1. **[Malwarebytes Anti-Malware](https://www.malwarebytes.org/)**: Anti-Malware сканнер. Из-за отсутствия поддержки командной строки для MBAM, мы просто установили его и продолжили дальше по скрипту. Таким образом, техник может нажать **SCAN** когда хочет, но скрипт не остановиться в ожидании ввода. Использование флагов `-sa` или `-sm` задаст пропуск запуска этого компонента.

2. **[KVRT](http://www.kaspersky.com/antivirus-removal-tool)**: Virus Remoal Tool от Лаборатории Касперского. Используйте флаги `-sa` или `-sk` для пропуска запуска данного компонента. Tron запускает его как:
	```
	-l %TEMP%\tdsskiller.log -silent -tdlfs -dcexact -accepteula -accepteulaksn
	```

3. **[Sophos Virus Removal Tool](https://www.sophos.com/en-us/products/free-tools/virus-removal-tool.aspx)**: антивирусный сканнер с поддержкой командной строки. Использование флага `-v` даст больше информации о сканировании. Использование флагов `-sa` или `-ss` отменит запуск данного компонента.


## STAGE 4: Repair (Стадия 4: Восстановление)

1. **DISM image check & repair**: Утилита проверки Windows Image Store от Microsoft(Одна из самых мощных проверочных утилит файловой системы). Только windows 8 и выше.

2. **Сброс прав реестра**: Дает пользователям `SYSTEM` и `Administrator` полные права на HKLM, HKCU, HKCR ветки реестра. Это операция только по разрешению прав(Без дальнейшего изменения или удаления). Используйте флаг `-ssr` что бы пропустить данную операцию.

3. **Сброс прав файловой системы**: Дает пользователям `SYSTEM` и `Administrator` полные права на директорию `%WinDri%` и последующие подкаталоги. Используйте флаг `-sfr` что бы пропустить данную операцию.

4. **[System File Checker](https://support.microsoft.com/en-us/kb/929833)**: Утилита от Microsoft для проверки файловой системы на ошибки и попытки восстановления в случае нахождения оных. Только для Windows Vista и выше(XP и ниже требуют перезагрузки).

5. **chkdsk**: Проверяет диск на ошибки и вносит chkdsk в загрузку для последующего исправления оных. 

6. **Удаление средств телеметрии Windows**: Отключает телеметрию Windows(отслеживание действий пользователя), Только Windows 7 и выше. Если скрипт запущен на windows 7/8/8.1, Tron удаляет "плохие" обновления Microsoft, которые выпущены для этих версий с целью включения телеметрии в них. Tron удаляет эти обновления из windows 7/8/8.1: `2952664`, `2976978`, `2990214`, `3021917`, `3022345`, `3068708`, `3080149`, `3075249`, `3035583`, `3044374`, `971033`. Tron так же отключает и удаляет `DiagTrack`(Диагностическая отслеживающая служба) службу. Если скрипт запущен под управлением Windows 10, Tron делает более глубокую очистку телеметрии Windows. Подробности смотрите в коде:`\tron\resources\stage_4_repair\purge_windows_telemetry\`, что бы увидеть что именно будет удалено и отключено. Используйте флаг `-str`, что бы пропустить данную операцию.

7. **Восстановление работы сети**: Tron делает мелкие восстановления конфигурации сети. Точнее, он запускает: `ipconfig /flushdns`,	`netsh interface ip delete arpcache`, `netsh winsock reset catalog`

8. **Восстановление файлов расширений**: Tron восстанавливает стандартные файлы расширений с помощью batch файла который зацикленно просматривает файлы реестра сохраненные в:`\tron\resources\stage_4_repair\repair_file_extensions\`


## STAGE 5: Patch (СТАДИЯ 5: Патч)
Tron устанавливает или обновляет эти программы:

1. **[7-Zip](http://7-zip.org/faq.html)**: Программа с открытым исходным кодом для сжатия и извлечения файлов. Всеядна, употребляет даже WinRAR). Используйте флаг `-sp`, что бы отменить данную операцию.

2. **Adobe Flash Player**: Используется для воспроизведения медиа-контента в сети. Используйте флаг `-sp`, что бы отменить данную операцию.

3. **Adobe Reader**: Стандартный просмотрщик PDF. Используйте флаг `-sp`, что бы отменить данную операцию.

4. **Java Runtime Enviroment**: Я ненавижу Java, но она еще достаточно распространена, поэтому включена в данный список. Используйте флаг `-sp`, что бы отменить данную операцию.

5. **Windows Update**: Запускает Windows Update с помощью: `wuauclt /detectnow /updatenow`

6. **DISM base reset**: Пересобирает "Windows Image Store" после того как мы ранее закончили удалять старые файлы. Только Windows 8 и выше.


## STAGE 6: Optimize (СТАДИЯ 6: Оптимизация)

1. **Сбрасывает файл подкачки**: Сбрасывает настройки файла подкачки до "Пускай Windows управляет файлом подкачки". Приводиться в действие с помощью:
	```
	`%WMIC% computersystem where name="%computername%" set AutomaticManagedPagefile=True`
	```
Используйте флаг `-spr`, что бы пропустить данную операцию.

2. **chkdsk**: Проверяет диск на ошибки и вносит chkdsk в загрузку для последующего исправления оных.

3. **[Defraggler](https://www.piriform.com/defraggler)**: утилита от Piriform для дефрагментации с поддержкой командной строки. Немного быстрее чем встроенная в Windows утилита.


## STAGE 7: Wrap-up (СТАДИЯ 7: Сводка)

1. **оповещение письмом**: Отправляет письмо с лог-файлами когда Tron закончит. Требует настройки SMTP в `\resources\stage_7_wrap-up\email_report\SwithMailSettings.xml`

2. **Генерация общего лога**: Генерация общих лог-файлов до и после развернутой информации о удаленных файлах и программах. Находятся по адресу: `LOGPATH\tron_summary_logs`. Дополнительно, если был установлен флаг `-er`, или настроен `EMAIL_REPORT`, эти логи будут прикреплены с письмом. 


## STAGE 8: Manual Tools (СТАДИЯ 8: Дополнительные инструменты)
Tron не запускает их автоматически, из-за того, что они не поддерживают командную строку, или полезны в специфических ситуациях. 

1. **[ADSSpy](http://www.bleepingcomputer.com/download/ads-spy/)**: Сканирует на наличие скрытых NTFS разделов. 

2. **[AdwCleaner](https://toolslib.net/downloads/viewdownload/1-adwcleaner/)**: Популярная программа для удаления таргетированной рекламы.

3. **[aswMBR](http://public.avast.com/~gmerek/aswMBR.htm)**: Rootkit сканнер.

4. **[autoruns](https://technet.microsoft.com/en-us/sysinternals/bb963902.aspx)**: Изучает и удаляет программы из автозагрузки.

5. **[ComboFix](http://www.combofix.org/)**: Руководствуется "Политикой Выжженой Земли" в процессе обнаружения malware. Работает только на windows xp, vista, 7. Не работает на windows 8 и выше.

6. **[PCHunter](http://www.majorgeeks.com/files/details/pc_hunter.html)**: Утилита сканирует на наличие rootkit`ов и других подозрительных вещей. Замещает собой gmer.

7. **[Junkware Removal Tool](http://thisisudax.org/)**: Временных файлов и рандомных рекламных баннеров удалитель.

8. **[Net Adapter Repair](http://www.bleepingcomputer.com/download/netadapter-repair-all-in-one/)**: Утилита для восстановления большинства проблем соединений windows.

9. **Remote Support Reboot Config**: Утилита для быстрого конфигурирования авто-логина и других параметров для запуска Tron через удаленное соединение. Спасибо reddit.com/user/cuddlychops06

10. **Safe Mode Boot Selector.bat**: batch файл бля быстрого выбора режима загрузки. (Безопасный Режим, с поддержкой сетевых драйверов и т.д.) Спасибо reddit.com/user/cuddlychops06

11. **ServicesRepair.exe**: утилита от ESET для восстановления сломанных\не_работающих служб Windows. 

12. **Tron Reset Tool**:Утилита для быстрого восстановления Tron, если скрипт поврежден или прерывается во время работы.

13. **VirusTotal uploader tool**: Загружает файл прямиком на VirusTotal для сканирования. 
